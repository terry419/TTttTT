신규 카드 시스템 기능 설계서 (GDD)
문서 버전: 1.0

작성일: 2025년 8월 30일

작성자: Gemini, User

1. 개요 (Overview)
1.1. 목표 (Goal)
본 문서는 기존 카드 시스템을 확장하여, 아래 4가지 핵심 컨셉의 카드를 구현하는 데 필요한 모든 신규/수정 컴포넌트의 설계와 동작 방식을 정의하는 것을 목표로 한다.

**지속 피해(DoT)**를 주는 카드 (예: 독, 화상)

적에게 디버프를 거는 카드 (예: 둔화, 약화)

플레이어에게 버프 또는 리스크를 부여하는 카드

적에게 **특수 표식(저주)**을 남기고, 적 사망 시 추가 효과를 발동시키는 카드

1.2. 핵심 설계 철학 (Core Design Philosophy)
우리의 논의를 통해 다음과 같은 설계 철학을 확정했다.

안정성 (Stability): 플레이어 대상 효과와 적 대상 효과를 스크립트 레벨에서 명확히 분리하여, 엉뚱한 대상에게 효과가 적용되어 버그가 발생하는 것을 원천적으로 차단한다.

편의성 (Convenience): 디자이너가 카드를 제작할 때, 효과에 대한 모든 설정을 모듈 인스펙터 내에서 한 번에 끝낼 수 있도록 데이터를 내장(Embed)하는 방식을 채택한다. (단, DamageZoneController처럼 재사용성이 중요한 경우는 예외)

직관성 (Intuitiveness): 필드의 순서와 명칭을 논리적으로 배치하고, Duration이 0일 때 즉발 효과로 동작하는 등 디자이너가 예측 가능한 방식으로 시스템이 작동하도록 설계한다.

2. 컴포넌트별 상세 설계
2.1. ApplyEffectToHitTargetModule.cs (적 대상 효과 모듈)

역할: 적에게 적용되는 모든 종류의 효과를 정의하고 실행하는 카드 모듈.

동작 방식:

카드의 Trigger(예: OnHit) 조건이 만족되면, 설정된 Application Chance 확률에 따라 효과 발동 여부를 결정한다.

효과가 발동하면, 적중된 대상(HitTarget)에게 인스펙터에 설정된 모든 효과(스탯, DoT, 회복 등)를 Duration만큼 적용한다.

상태이상 적용 규칙:

버프/디버프: 스탯 보너스 필드의 값이 양수(+)이면 버프, 음수(-)이면 디버프로 적용된다.

중첩(Stacking): 동일한 Status Effect ID를 가진 효과가 이미 대상에게 적용 중일 경우, Stacking Behavior에 정의된 규칙을 따른다. (정책 확정: 가장 나중에 적용된 효과의 규칙을 따른다.)

2.2. ApplyEffectToCasterModule.cs (플레이어 대상 효과 모듈)

역할: 플레이어 자신(Caster)에게 적용되는 모든 종류의 효과를 정의하고 실행하는 카드 모듈.

동작 방식: ApplyEffectToHitTargetModule과 동일한 로직으로, 대상을 플레이어로 한정하여 효과를 적용한다.

VFX 동작 명세:

On Apply VFX: 효과가 처음 적용되는 순간, 플레이어의 위치에 1회성으로 생성되었다가 사라진다. (Not Parented)

Looping VFX: 효과가 적용되는 순간, 플레이어 오브젝트의 자식으로 생성되어 효과가 지속되는 동안 계속 재생된다. Duration이 끝나면 파괴된다. (Parented)

On Expire VFX: 효과의 Duration이 끝나 사라지는 순간, 플레이어의 위치에 1회성으로 생성되었다가 사라진다. (Not Parented)

2.3. DamageZoneController.cs (영역 효과 컨트롤러)

역할: 게임 월드에 물리적인 영역을 생성하여, 해당 범위에 들어오는 대상에게 정의된 효과를 지속적으로 적용하는 환경 효과 컴포넌트.

동작 방식:

생성되면 Zone Duration만큼 씬에 존재한다.

자신의 Radius 범위 안으로 "Monster" 태그를 가진 오브젝트가 들어오면, [범위 내 적에게 부여할 효과] 섹션에 정의된 모든 효과를 적용한다.

범위 안으로 "Player" 태그를 가진 오브젝트가 들어오면, [범위 내 플레이어에게 부여할 효과] 섹션에 정의된 모든 효과를 적용한다.

대상이 범위를 벗어나면, 이 컴포넌트가 부여했던 효과는 즉시 제거된다. (단, Applied Effect Duration이 설정된 경우 그 시간만큼 유지된다.)

2.4. DetonateEffectsModule.cs (지속 피해 폭발 모듈)

역할: 대상에게 걸린 지속 피해(DoT) 효과들을 강제로 발동시켜 큰 피해를 주는 특수 카드 모듈.

동작 방식:

Trigger 조건이 만족되면, 적중된 대상(HitTarget)에게 현재 적용 중인 모든 지속 피해 효과를 StatusEffectManager를 통해 조회한다.

(Status Effect ID Filter가 지정된 경우) 해당 ID를 가진 효과들만 필터링한다.

필터링된 각 효과의 남은 지속시간과 초당 피해량을 곱하여, 앞으로 입힐 수 있는 '잠재적 총 피해량'을 모두 합산한다.

이 총합에 Damage Multiplier(%)를 곱하여 최종 즉발 피해량을 계산한다.

계산된 피해를 대상에게 즉시 입힌다.

Consume Effects가 체크되어 있다면, 대상에게 걸려있던 모든 지속 피해 효과를 제거한다.

2.5. CurseExplosionManager.cs (저주 폭발 관리자)

역할: 특정 표식(저주)을 가진 적의 죽음을 감지하여 추가 효과를 발동시키는 전역(Global) 관리자.

동작 방식:

게임이 시작되면, 모든 몬스터의 사망 이벤트(MonsterController.OnMonsterDied)를 구독한다.

몬스터가 죽으면, 해당 몬스터가 Curse Status Effect ID에 지정된 ID의 상태이상을 가지고 있었는지 검사한다.

만약 가지고 있었다면, 몬스터가 죽은 위치에 **[폭발 효과 설정]**에 정의된 피해량, 범위, VFX를 가진 폭발을 생성한다.